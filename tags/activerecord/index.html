<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>activerecord | metalelf0.github.io</title><meta name=keywords content><meta name=description content="Andrea Schiavini is a ruby developer based in Milan, Italy"><meta name=author content="metalelf0"><link rel=canonical href=https://metalelf0.github.io/tags/activerecord/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><link rel=icon href=https://metalelf0.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://metalelf0.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://metalelf0.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://metalelf0.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://metalelf0.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://metalelf0.github.io/tags/activerecord/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="activerecord"><meta property="og:description" content="Andrea Schiavini is a ruby developer based in Milan, Italy"><meta property="og:type" content="website"><meta property="og:url" content="https://metalelf0.github.io/tags/activerecord/"><meta property="og:site_name" content="metalelf0.github.com"><meta name=twitter:card content="summary"><meta name=twitter:title content="activerecord"><meta name=twitter:description content="Andrea Schiavini is a ruby developer based in Milan, Italy"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://metalelf0.github.io accesskey=h title="metalelf0.github.io (Alt + H)">metalelf0.github.io</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://metalelf0.github.io>Home</a>&nbsp;»&nbsp;<a href=https://metalelf0.github.io/tags/>Tags</a></div><h1>activerecord</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>Howto run a rake task in sandbox mode</h2></header><section class=entry-content><p>If you have a Rails rake task that somehow changes your DB data, but you want to be sure that the DB will be rolled back to its previous state after the rake task has completed, you can simply include this snippet right after your task definition:
ActiveRecord::Base.connection.increment_open_transactions ActiveRecord::Base.connection.begin_db_transaction at_exit do ActiveRecord::Base.connection.rollback_db_transaction ActiveRecord::Base.connection.decrement_open_transactions end If you wonder where is this code coming from, it’s directly from the rails console code....</p></section><footer class=entry-footer><span title="2011-03-10 00:00:00 +0000 UTC">March 10, 2011</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;metalelf0</footer><a class=entry-link aria-label="post link to Howto run a rake task in sandbox mode" href=https://metalelf0.github.io/posts/old-website/2011-03-10-howto-run-a-rake-task-in-sandbox-mode/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>Rails 3 scopes with HABTM (has and belongs to many) relations</h2></header><section class=entry-content><p>There are already many posts about this, but maybe this simple example will help you understand this subject even better.
# First model: tag.rb # note that pomodori is a custom plural for pomodoro class Tag &lt; ActiveRecord::Base has_and_belongs_to_many :pomodori end # Second model: pomodoro.rb # here is how to define a Rails 3 scope through the join table: class Pomodoro &lt; ActiveRecord::Base has_and_belongs_to_many :tags scope :by_tag, lambda { |tag_text| joins("join pomodori_tags, tags")....</p></section><footer class=entry-footer><span title="2011-01-28 00:00:00 +0000 UTC">January 28, 2011</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;metalelf0</footer><a class=entry-link aria-label="post link to Rails 3 scopes with HABTM (has and belongs to many) relations" href=https://metalelf0.github.io/posts/old-website/2011-01-28-rails-3-scopes-with-habtm-has-and-belongs-to-many-relations/></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://metalelf0.github.io>metalelf0.github.io</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>