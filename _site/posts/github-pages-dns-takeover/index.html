<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="The github pages DNS takeover incident" /><meta property="og:locale" content="en" /><meta name="description" content="This website, andreaschiavini.com, is hosted on GitHub Pages. The domain is registered on Namecheap, and the integration was done following instructions on this gist." /><meta property="og:description" content="This website, andreaschiavini.com, is hosted on GitHub Pages. The domain is registered on Namecheap, and the integration was done following instructions on this gist." /><link rel="canonical" href="https://www.andreaschiavini.com/posts/github-pages-dns-takeover/" /><meta property="og:url" content="https://www.andreaschiavini.com/posts/github-pages-dns-takeover/" /><meta property="og:site_name" content="Andrea Schiavini" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-12-30T10:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="The github pages DNS takeover incident" /><meta name="twitter:site" content="@metalelf0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-30T10:00:00+01:00","datePublished":"2024-12-30T10:00:00+01:00","description":"This website, andreaschiavini.com, is hosted on GitHub Pages. The domain is registered on Namecheap, and the integration was done following instructions on this gist.","headline":"The github pages DNS takeover incident","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.andreaschiavini.com/posts/github-pages-dns-takeover/"},"url":"https://www.andreaschiavini.com/posts/github-pages-dns-takeover/"}</script><title>The github pages DNS takeover incident | Andrea Schiavini</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Andrea Schiavini"><meta name="application-name" content="Andrea Schiavini"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JLL0M2ET40"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-JLL0M2ET40'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/metalelf0.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Andrea Schiavini</a><p class="site-subtitle fst-italic mb-0">metalelf0 personal website</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/metalelf0" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/metalelf0" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['metalelf0gmail.com',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/metalelf0" aria-label="linkedin" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/165339/metalelf0" aria-label="stack-overflow" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://flickr.com/metalelf0" aria-label="flickr" > <i class="fab fa-flickr"></i> </a> <a href="https://www.reddit.com/user/metalelf0/" aria-label="reddit" > <i class="fa-brands fa-reddit"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>The github pages DNS takeover incident</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="false"><header><h1 data-toc-skip>The github pages DNS takeover incident</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1735549200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 30, 2024 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/metalelf0">Andrea Schiavini</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="601 words" > <em>3 min</em> read</span></div></div></div></header><div class="content"><p>This website, <code class="language-plaintext highlighter-rouge">andreaschiavini.com</code>, is hosted on GitHub Pages. The domain is registered on Namecheap, and the integration was done following instructions <a href="https://gist.github.com/plembo/84f80c920bb5ac6f19e53fe6f8db1ff7">on this gist</a>.</p><p>Last week, I received an email from Google saying that some users had been added as property owners of my Google Search Console property. This raised an eyebrow, and I checked my website. Instead of my website, it showed some sort of slot machine scam website.</p><p>The first thing I checked was my DNS settings. They were correct, and checking via <code class="language-plaintext highlighter-rouge">dig</code> apparently reported no issue:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>➜ dig +noall +answer +nocmd andreaschiavini.com
andreaschiavini.com.    1800    IN      A       185.199.108.153
andreaschiavini.com.    1799    IN      A       185.199.109.153
andreaschiavini.com.    1799    IN      A       185.199.110.153
andreaschiavini.com.    1799    IN      A       185.199.111.153

➜ dig +noall +answer +nocmd www.andreaschiavini.com
www.andreaschiavini.com. 856    IN      CNAME   metalelf0.github.io.
metalelf0.github.io.    856     IN      A       185.199.109.153
metalelf0.github.io.    856     IN      A       185.199.111.153
metalelf0.github.io.    856     IN      A       185.199.110.153
metalelf0.github.io.    856     IN      A       185.199.108.153
</pre></table></code></div></div><p>After a quick check with the support folks from namecheap, which excluded any DNS issue, I switched to the github side.</p><p>My website is a static blog built using hugo and deployed via github actions. Considering I’m using a custom theme, I suspected something might have happened on the javascript side, e.g. some external javascript that was included by the theme and accidentally got hacked to perform a redirect. However, inspecting the site loading reported that the first call (the <code class="language-plaintext highlighter-rouge">GET /</code> call) was already returning the scam website, so before any javascript was loaded and executed.</p><p>Github actions also weren’t ran since the last deploy, that happened more than a month ago, so I excluded them from my analysis.</p><p>I needed to check if everything was right on the github pages side. I opened my github pages repository settings and checked for the custom domains section. My custom domain was not there anymore. This was kinda strange, I thought, cause I already added and validated it. I tried adding it back but I got an error:</p><blockquote><p>The custom domain <code class="language-plaintext highlighter-rouge">andreaschiavini.com</code> is already taken. If you are the owner of this domain, check out <a href="https://docs.github.com/pages/configuring-a-custom-domain-for-your-github-pages-site/verifying-your-custom-domain-for-github-pages">https://docs.github.com/pages/configuring-a-custom-domain-for-your-github-pages-site/verifying-your-custom-domain-for-github-pages</a> for information about how to verify and release this domain.</p></blockquote><p>When we register a custom domain for a Google Pages website, we are advised to verify the domain. This process involves adding a TXT record generated by GitHub to the DNS configuration. GitHub then checks the DNS information, and once it finds the expected TXT record, it confirms the domain as validated.</p><p>I did this the first time I set up the integration, but I carelessly removed the TXT record afterwards. This exposed my domain to be added by a malicious user and bound to another GitHub Pages website.</p><p>The important bit to notice here is how GitHub handles adding custom domains, which was not entirely clear to me:</p><ul><li>when you <em>add a custom domain</em>, GitHub just checks that the domain DNS records are set up correctly to point to the GitHub IPs (A records);<li>when you <em>validate a domain</em>, GitHub checks for the presence of the TXT record and verifies its content.</ul><p>So, after removing the TXT record by accident, all the attacker could do was add the domain to their GitHub repo, but they clearly couldn’t validate it (they would have needed access to my Namecheap account for that).</p><p>The solution at this point was pretty straightforward: I validated my domain from my GitHub profile settings, went through the procedure to add back the given TXT record, and once this was done successfully, I could add my custom domain to my GitHub Pages repository settings.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/posts/">posts</a>, <a href="/categories/technical/">technical</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/github/" class="post-tag no-text-decoration" >github</a> <a href="/tags/dns/" class="post-tag no-text-decoration" >dns</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The%20github%20pages%20DNS%20takeover%20incident%20-%20Andrea%20Schiavini&url=https%3A%2F%2Fwww.andreaschiavini.com%2Fposts%2Fgithub-pages-dns-takeover%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The%20github%20pages%20DNS%20takeover%20incident%20-%20Andrea%20Schiavini&u=https%3A%2F%2Fwww.andreaschiavini.com%2Fposts%2Fgithub-pages-dns-takeover%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.andreaschiavini.com%2Fposts%2Fgithub-pages-dns-takeover%2F&text=The%20github%20pages%20DNS%20takeover%20incident%20-%20Andrea%20Schiavini" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/github-pages-dns-takeover/">The github pages DNS takeover incident</a><li class="text-truncate lh-lg"> <a href="/posts/build-a-neovim-menu/">Build a neovim menu without external dependencies</a><li class="text-truncate lh-lg"> <a href="/posts/change-vim-colorscheme-based-on-iterm/">Vim - Change Colorscheme Based on Iterm profile</a><li class="text-truncate lh-lg"> <a href="/posts/vim-sort-ruby-methods-by-name/">Vim - sort ruby methods by name</a><li class="text-truncate lh-lg"> <a href="/posts/mocked-a-minitest-pattern/">Mocked - a minitest pattern</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/vim/">vim</a> <a class="post-tag btn btn-outline-primary" href="/tags/oop/">oop</a> <a class="post-tag btn btn-outline-primary" href="/tags/activerecord/">activerecord</a> <a class="post-tag btn btn-outline-primary" href="/tags/db/">db</a> <a class="post-tag btn btn-outline-primary" href="/tags/design/">design</a> <a class="post-tag btn btn-outline-primary" href="/tags/neovim/">neovim</a> <a class="post-tag btn btn-outline-primary" href="/tags/test/">test</a> <a class="post-tag btn btn-outline-primary" href="/tags/textmate/">textmate</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/the-right-colors-for-your-vim/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1328486400" data-df="ll" > Feb 6, 2012 </time><h4 class="pt-0 my-2">The right colors for your VIM</h4><div class="text-muted"><p>I have a lot of Vim colorschemes, and I like to change them very often, reflecting my mood. I needed a way to showcase them all and quickly pick one. The original Vim Color Scheme Test script by m...</p></div></div></a></article><article class="col"> <a href="/posts/using-virtual-attributes-for-multi-parameter-form-helpers-in-rails/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1319760000" data-df="ll" > Oct 28, 2011 </time><h4 class="pt-0 my-2">Using virtual attributes for multi parameter form helpers in Rails</h4><div class="text-muted"><p>In a Rails application I am working on, I needed to setup a form with a field with a non-standard behaviour. The field represents a Date object, so the date_select FormHelper looked great; however,...</p></div></div></a></article><article class="col"> <a href="/posts/machinist-vs-factory-girl-machinist-win/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1308441600" data-df="ll" > Jun 19, 2011 </time><h4 class="pt-0 my-2">Machinist vs Factory Girl: Machinist win!</h4><div class="text-muted"><p>Today I decided to verify if Machinist could be a good replacement for Factory Girl. In our project, we have a big problem with Factory Girl: even if you tell her not to hit the database, using the...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/build-a-neovim-menu/" class="btn btn-outline-primary" aria-label="Older" ><p>Build a neovim menu without external dependencies</p></a><div class="btn btn-outline-primary disabled" aria-label="Newer"><p>-</p></div></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://twitter.com/metalelf0">Andrea Schiavini</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/vim/">vim</a> <a class="post-tag btn btn-outline-primary" href="/tags/oop/">oop</a> <a class="post-tag btn btn-outline-primary" href="/tags/activerecord/">activerecord</a> <a class="post-tag btn btn-outline-primary" href="/tags/db/">db</a> <a class="post-tag btn btn-outline-primary" href="/tags/design/">design</a> <a class="post-tag btn btn-outline-primary" href="/tags/neovim/">neovim</a> <a class="post-tag btn btn-outline-primary" href="/tags/test/">test</a> <a class="post-tag btn btn-outline-primary" href="/tags/textmate/">textmate</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
