<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Fluentd usage example with bash and ruby" /><meta property="og:locale" content="en" /><meta name="description" content="Andrea Schiavini is a ruby developer based in Milan, Italy 🇮🇹" /><meta property="og:description" content="Andrea Schiavini is a ruby developer based in Milan, Italy 🇮🇹" /><link rel="canonical" href="https://www.andreaschiavini.com/posts/fluentd-usage-example-with-bash-and-ruby/" /><meta property="og:url" content="https://www.andreaschiavini.com/posts/fluentd-usage-example-with-bash-and-ruby/" /><meta property="og:site_name" content="Andrea Schiavini" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-08-09T02:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Fluentd usage example with bash and ruby" /><meta name="twitter:site" content="@metalelf0" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2013-08-09T02:00:00+02:00","datePublished":"2013-08-09T02:00:00+02:00","description":"Andrea Schiavini is a ruby developer based in Milan, Italy 🇮🇹","headline":"Fluentd usage example with bash and ruby","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.andreaschiavini.com/posts/fluentd-usage-example-with-bash-and-ruby/"},"url":"https://www.andreaschiavini.com/posts/fluentd-usage-example-with-bash-and-ruby/"}</script><title>Fluentd usage example with bash and ruby | Andrea Schiavini</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Andrea Schiavini"><meta name="application-name" content="Andrea Schiavini"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-JLL0M2ET40"></script> <script> document.addEventListener('DOMContentLoaded', () => { window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-JLL0M2ET40'); }); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/metalelf0.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Andrea Schiavini</a><p class="site-subtitle fst-italic mb-0">metalelf0 personal website</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/metalelf0" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/metalelf0" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['metalelf0gmail.com',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/metalelf0" aria-label="linkedin" > <i class="fab fa-linkedin"></i> </a> <a href="https://stackoverflow.com/users/165339/metalelf0" aria-label="stack-overflow" > <i class="fab fa-stack-overflow"></i> </a> <a href="https://flickr.com/metalelf0" aria-label="flickr" > <i class="fab fa-flickr"></i> </a> <a href="https://www.reddit.com/user/metalelf0/" aria-label="reddit" > <i class="fa-brands fa-reddit"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Fluentd usage example with bash and ruby</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Fluentd usage example with bash and ruby</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1376006400" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 9, 2013 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/metalelf0">Andrea Schiavini</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="875 words" > <em>4 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Fluentd usage example with bash and ruby</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Fluentd usage example with bash and ruby</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><div style="background-color: white; margin-bottom: 20px;"> <a href="/assets/images/2013-08-09-fluentd-usage-example-with-bash-and-ruby/fluentd2.png" class="popup img-link shimmer"><img src="/assets/images/2013-08-09-fluentd-usage-example-with-bash-and-ruby/fluentd2.png" loading="lazy"></a></div><p><a href="http://fluentd.org/">Fluentd</a> is an open source tool to collect events and logs. Its architecture allows to easily collect logs from different input sources and redirect them to different output sinks. Some input examples are HTTP, syslog, or apache logs, and some output sinks are files, mail, and databases (both RDBMS and NoSQL ones). Also, it allows to parse logs and to extract only the significative parts from each of them; saving this structured information on a DB allows much easier log searching and analysis.</p><p>The fluentd architecture can be extended with ruby plugins to support input sources and output destinations; for the scope of this example, we will use:</p><ul><li><a href="https://github.com/fluent/fluent-plugin-mongo">MongoDB plugin for Fluent event collector</a>;<li><a href="https://github.com/fluent/fluent-logger-ruby">fluent-logger rubygem</a>;<li>the built-in tcp input and stdout output.</ul><h3 id="installing-fluentd-server"><span class="me-2">Installing fluentd server</span><a href="#installing-fluentd-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The first thing to do is installing the fluentd server. You can easily do this via rubygems (beware it requires at least ruby 1.9.2):</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ gem install fluentd
</pre></table></code></div></div><p>When you’re done you can create a setup file:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ fluentd -s ~/.fluentd
</pre></table></code></div></div><p>This will create the file <code class="language-plaintext highlighter-rouge">~/.fluentd/fluent.conf</code> and setup the <code class="language-plaintext highlighter-rouge">~/.fluent/plugins</code> folder.</p><h3 id="the-fluentdconf-file"><span class="me-2">The fluentd.conf file</span><a href="#the-fluentdconf-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Edit the configuration file with your favourite editor (which is vim, of course), and make it look like this:</p><div class="language-conf highlighter-rouge"><div class="code-header"> <span data-label-text="Conf"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c">## built-in TCP input
## $ echo &lt;json&gt; | fluent-cat &lt;tag&gt;
</span>&lt;<span class="n">source</span>&gt;
  <span class="n">type</span> <span class="n">forward</span>
  <span class="n">port</span> <span class="m">24224</span>
&lt;/<span class="n">source</span>&gt;

<span class="c">## match tag=fluentd.test.** and dump to console
</span>&lt;<span class="n">match</span> <span class="n">fluentd</span>.<span class="n">test</span>.**&gt;
  <span class="n">type</span> <span class="n">stdout</span>
&lt;/<span class="n">match</span>&gt;

&lt;<span class="n">match</span> <span class="n">mongo</span>.**&gt;
  <span class="n">type</span> <span class="n">mongo</span>
  <span class="n">host</span> <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>
  <span class="n">port</span> <span class="m">27017</span>
  <span class="n">database</span> <span class="n">fluentd</span>
  <span class="n">collection</span> <span class="n">test</span>

  <span class="c"># for capped collection
</span>  <span class="n">capped</span>
  <span class="n">capped_size</span> <span class="m">1024</span><span class="n">m</span>

  <span class="c"># flush
</span>  <span class="n">flush_interval</span> <span class="m">1</span><span class="n">s</span>
&lt;/<span class="n">match</span>&gt;
</pre></table></code></div></div><p>You can see it’s made of three parts:</p><ol><li>The first one is the default HTTP source input. It listens for JSON messages on port <code class="language-plaintext highlighter-rouge">24224</code>.<li>The second one is the default standard output. The <code class="language-plaintext highlighter-rouge">match fluentd.test.**</code> line tells fluentd to forward all messages matching the given pattern to the chosen standard output.<li>The third block is the MongoDB output. It requires the MongoDB plugin cited above to be installed, but we’ll talk about this later.</ol><p>Let’s start the server and keep it running in foreground, to easily see incoming messages:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ fluentd -c ~/.fluent/fluent.conf
</pre></table></code></div></div><h3 id="logging-from-bash-to-stdout"><span class="me-2">Logging from bash to STDOUT</span><a href="#logging-from-bash-to-stdout" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now, let’s prepare a sample bash script to log things to <code class="language-plaintext highlighter-rouge">fluentd</code>. Open another terminal, create a bash script and paste the following content:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c">#!/bin/sh</span>

fluent_log<span class="o">(){</span>
  <span class="nb">local </span><span class="nv">project</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>
  <span class="nb">local </span><span class="nv">script_name</span><span class="o">=</span><span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
  <span class="nb">local </span><span class="nv">message</span><span class="o">=</span><span class="s2">"</span><span class="nv">$3</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">"</span>project<span class="se">\"</span><span class="s2">":</span><span class="se">\"</span><span class="s2">"</span><span class="nv">$project</span><span class="s2">"</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">"</span>script_name<span class="se">\"</span><span class="s2">":</span><span class="se">\"</span><span class="s2">"</span><span class="nv">$script_name</span><span class="s2">"</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">"</span>message<span class="se">\"</span><span class="s2">":</span><span class="se">\"</span><span class="s2">"</span><span class="nv">$message</span><span class="se">\"</span><span class="s2">"}"</span> | fluent-cat fluentd.test.log
<span class="o">}</span>

fluent_log <span class="s2">"Library"</span> <span class="s2">"Reload books"</span> <span class="s2">"Started"</span>
</pre></table></code></div></div><p>As you can see I created a wrapper function to make it easier to redirect logs to <code class="language-plaintext highlighter-rouge">fluentd</code>. Save the file, make it executable and run it. You should see output like this in your server:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>2013-08-09 17:01:06 +0200 [trace]: plugin/in_forward.rb:150:initialize: accepted fluent socket object_id=70144024060720
2013-08-09 17:01:06 +0200 fluentd.test.log: {"project":"Library","script_name":"Reload books","message":"Started"}
2013-08-09 17:01:06 +0200 [trace]: plugin/in_forward.rb:191:on_close: closed fluent socket object_id=70144024060720
</pre></table></code></div></div><p>This is telling us that <code class="language-plaintext highlighter-rouge">fluentd</code> is accepting input from the <code class="language-plaintext highlighter-rouge">fluent-cat</code> command and it is redirecting it to standard output, according to the first rule.</p><h3 id="logging-from-bash-to-mongodb"><span class="me-2">Logging from bash to MongoDB</span><a href="#logging-from-bash-to-mongodb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To go on in our test, we need to install MongoDB. Use the best way depending on your system (I used <code class="language-plaintext highlighter-rouge">homebrew</code> on my mac), run it and connect to its console via the <code class="language-plaintext highlighter-rouge">mongo</code> command.</p><p>Now, in the previous bash script, change the target of <code class="language-plaintext highlighter-rouge">fluent-cat</code> from <code class="language-plaintext highlighter-rouge">fluentd.test.log</code> to <code class="language-plaintext highlighter-rouge">mongo.log</code>. Save it, run it again, and type this in your MongoDB console:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ db.test.find()
</pre></table></code></div></div><p>This time you should see an entry in the <code class="language-plaintext highlighter-rouge">test</code> collection:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{ "_id" : ObjectId("5204dfee9f60b167da000004"), "project" : "Library", "script_name" : "Reload books", "message" : "Started", "time" : ISODate("2013-08-09T12:26:22Z") }
</pre></table></code></div></div><h3 id="logging-from-ruby-to-mongodb"><span class="me-2">Logging from ruby to MongoDB</span><a href="#logging-from-ruby-to-mongodb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s see how to achieve the same result in a ruby script. Install the fluent-logger rubygem with</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>$ gem install fluent-logger
</pre></table></code></div></div><p>Then create a ruby script with the following content:</p><div class="language-ruby highlighter-rouge"><div class="code-header"> <span data-label-text="Ruby"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env ruby</span>

<span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'fluent-logger'</span>

<span class="k">def</span> <span class="nf">fluent_log</span> <span class="n">project</span><span class="p">,</span> <span class="n">script_name</span><span class="p">,</span> <span class="n">message</span>
  <span class="no">Fluent</span><span class="o">::</span><span class="no">Logger</span><span class="o">::</span><span class="no">FluentLogger</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="ss">:host</span><span class="o">=&gt;</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="ss">:port</span><span class="o">=&gt;</span><span class="mi">24224</span><span class="p">)</span>
  <span class="no">Fluent</span><span class="o">::</span><span class="no">Logger</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"mongo.log"</span><span class="p">,</span> <span class="p">{</span><span class="ss">:project</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">,</span> <span class="ss">:script_name</span> <span class="o">=&gt;</span> <span class="n">script_name</span><span class="p">,</span> <span class="ss">:message</span> <span class="o">=&gt;</span> <span class="n">message</span> <span class="p">})</span>
<span class="k">end</span>

<span class="n">fluent_log</span> <span class="s2">"Library"</span><span class="p">,</span> <span class="s2">"Update books"</span><span class="p">,</span> <span class="s2">"Completed"</span>
</pre></table></code></div></div><p>Run it, rerun the query in the MongoDB console, and a new entry should be present.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{ "_id" : ObjectId("5204dfee9f60b167da000005"), "project" : "Library", "script_name" : "Reload books", "message" : "Completed", "time" : ISODate("2013-08-09T12:46:32Z") }
</pre></table></code></div></div><h3 id="final-considerations"><span class="me-2">Final considerations</span><a href="#final-considerations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The ease of use of <code class="language-plaintext highlighter-rouge">fluentd</code> allows to quickly setup a centralized log system in just a few hours. You could use any tool you want to browse data in the MongoDB database. You can make elaborate statistics, build charts, and do everything you want with it. According to the <code class="language-plaintext highlighter-rouge">fluentd</code> website, its simple architecture allows it to run with very good performances:</p><blockquote><p>“Fluentd’s performance has been proven in the field: its largest user currently collects logs from 5000+ servers, 5 TB of daily data, handling 50,000 msgs/sec at peak time.”</p></blockquote><p>So, I hope this post helped you to understand what this tool is about. I suggest you to check out the <a href="http://docs.fluentd.org/articles/quickstart">fluentd documentation</a> to know more, it’s really complete and clear. If you found this post useful, feel free to drop me a line :)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/posts/">posts</a>, <a href="/categories/technical/">technical</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ruby/" class="post-tag no-text-decoration" >ruby</a> <a href="/tags/logging/" class="post-tag no-text-decoration" >logging</a> <a href="/tags/json/" class="post-tag no-text-decoration" >json</a> <a href="/tags/fluentd/" class="post-tag no-text-decoration" >fluentd</a> <a href="/tags/bash/" class="post-tag no-text-decoration" >bash</a> <a href="/tags/shell/" class="post-tag no-text-decoration" >shell</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Fluentd%20usage%20example%20with%20bash%20and%20ruby%20-%20Andrea%20Schiavini&url=https%3A%2F%2Fwww.andreaschiavini.com%2Fposts%2Ffluentd-usage-example-with-bash-and-ruby%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Fluentd%20usage%20example%20with%20bash%20and%20ruby%20-%20Andrea%20Schiavini&u=https%3A%2F%2Fwww.andreaschiavini.com%2Fposts%2Ffluentd-usage-example-with-bash-and-ruby%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.andreaschiavini.com%2Fposts%2Ffluentd-usage-example-with-bash-and-ruby%2F&text=Fluentd%20usage%20example%20with%20bash%20and%20ruby%20-%20Andrea%20Schiavini" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/github-pages-dns-takeover/">The github pages DNS takeover incident</a><li class="text-truncate lh-lg"> <a href="/posts/build-a-neovim-menu/">Build a neovim menu without external dependencies</a><li class="text-truncate lh-lg"> <a href="/posts/change-vim-colorscheme-based-on-iterm/">Vim - Change Colorscheme Based on Iterm profile</a><li class="text-truncate lh-lg"> <a href="/posts/vim-sort-ruby-methods-by-name/">Vim - sort ruby methods by name</a><li class="text-truncate lh-lg"> <a href="/posts/mocked-a-minitest-pattern/">Mocked - a minitest pattern</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/vim/">vim</a> <a class="post-tag btn btn-outline-primary" href="/tags/oop/">oop</a> <a class="post-tag btn btn-outline-primary" href="/tags/activerecord/">activerecord</a> <a class="post-tag btn btn-outline-primary" href="/tags/db/">db</a> <a class="post-tag btn btn-outline-primary" href="/tags/design/">design</a> <a class="post-tag btn btn-outline-primary" href="/tags/neovim/">neovim</a> <a class="post-tag btn btn-outline-primary" href="/tags/test/">test</a> <a class="post-tag btn btn-outline-primary" href="/tags/textmate/">textmate</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/the-right-colors-for-your-vim/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1328486400" data-df="ll" > Feb 6, 2012 </time><h4 class="pt-0 my-2">The right colors for your VIM</h4><div class="text-muted"><p>I have a lot of Vim colorschemes, and I like to change them very often, reflecting my mood. I needed a way to showcase them all and quickly pick one. The original Vim Color Scheme Test script by m...</p></div></div></a></article><article class="col"> <a href="/posts/using-virtual-attributes-for-multi-parameter-form-helpers-in-rails/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1319760000" data-df="ll" > Oct 28, 2011 </time><h4 class="pt-0 my-2">Using virtual attributes for multi parameter form helpers in Rails</h4><div class="text-muted"><p>In a Rails application I am working on, I needed to setup a form with a field with a non-standard behaviour. The field represents a Date object, so the date_select FormHelper looked great; however,...</p></div></div></a></article><article class="col"> <a href="/posts/invalid-option-with-pg-diroptpostgresql90/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1295308800" data-df="ll" > Jan 18, 2011 </time><h4 class="pt-0 my-2">invalid option: with pg dir=/opt/PostgreSQL/9.0</h4><div class="text-muted"><p>I’d bet a lot of ruby devs actually found themselves stuck in this problem. You checkout a github repo, you run a bundle install and - duh - a gem cannot install because of a missing library. You’r...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/easily-change-the-path-for-your-paperclip-attachments/" class="btn btn-outline-primary" aria-label="Older" ><p>Easily change the path for your Paperclip attachments</p></a> <a href="/posts/null-objects-in-rails/" class="btn btn-outline-primary" aria-label="Newer" ><p>Null objects in Rails</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://twitter.com/metalelf0">Andrea Schiavini</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/ruby/">ruby</a> <a class="post-tag btn btn-outline-primary" href="/tags/rails/">rails</a> <a class="post-tag btn btn-outline-primary" href="/tags/vim/">vim</a> <a class="post-tag btn btn-outline-primary" href="/tags/oop/">oop</a> <a class="post-tag btn btn-outline-primary" href="/tags/activerecord/">activerecord</a> <a class="post-tag btn btn-outline-primary" href="/tags/db/">db</a> <a class="post-tag btn btn-outline-primary" href="/tags/design/">design</a> <a class="post-tag btn btn-outline-primary" href="/tags/neovim/">neovim</a> <a class="post-tag btn btn-outline-primary" href="/tags/test/">test</a> <a class="post-tag btn btn-outline-primary" href="/tags/textmate/">textmate</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
